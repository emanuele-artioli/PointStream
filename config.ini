# PointStream Configuration File
# This file contains all configurable parameters for the PointStream pipeline
# Organized by component for better maintainability

[scene_detection]
# Scene detection algorithm parameters
detector_type = multi
threshold = 27.0
min_scene_len = 10
luma_only = false

# Performance optimization
enable_downscaling = true
downscale_factor = 4
use_stats_manager = false

# Multi-detector settings (when detector_type = multi)
multi_detector_threshold = 1.0
content_weight = 1.0
adaptive_weight = 0.8
histogram_weight = 0.6
hash_weight = 0.9

# Advanced detector parameters
adaptive_window_frames = 60
histogram_bins = 256
hash_size = 8
interpolation_method = linear

# Batch processing for scene detection
batch_size = 100
overlap_frames = 10
default_max_frames = 1000
default_output_pattern = {input_stem}_scenes

# Quality control for scenes
min_scene_duration = 0.5
max_scene_duration = 300
verify_output_files = true
check_video_integrity = true

[encoding]
# Video encoding parameters
video_codec = libsvtav1
audio_codec = libopus
container_format = mp4

# Video quality settings
crf = 30
preset = 6
pixel_format = yuv420p
color_range = tv
color_space = bt709

# Audio settings
audio_bitrate = 128k
audio_sample_rate = 48000
audio_channels = 2

# FFmpeg settings
ffmpeg_binary = ffmpeg
ffmpeg_timeout = 300
ffmpeg_threads = 0
faststart = true
continue_on_error = false
retry_failed = 1
extra_input_args = []
extra_output_args = []

# Video backend for input
backend = auto

# File output
scene_filename_pattern = scene_{number:04d}.{extension}
scene_list_filename = scene_list.txt
metadata_filename = metadata.json
export_metadata = true
include_timestamps = true
include_file_info = true
include_encoding_info = true

# Quality control for files  
min_file_size_kb = 10
max_file_size_mb = 1000

[segmentation]
# YOLO model configuration - using faster model for speed
yolo_model = /home/itec/emanuele/models/yoloe-11s-seg-pf.pt
confidence_threshold = 0.75
iou_threshold = 0.7
max_objects_per_frame = 5
device = cuda
agnostic_nms = true

# Performance optimization settings
yolo_image_size = 640
yolo_half_precision = true
yolo_stream = true
classes = []

# Object tracking settings
selection_strategy = confidence
min_object_area = 500
frame_skip = 1

[stitching]
# Feature detector choice: 'orb' (fast) or 'sift' (accurate)
feature_detector = orb

# ORB parameters optimized for speed
orb_nfeatures = 1500

# SIFT parameters (when using sift)
sift_nfeatures = 500

# Matching and homography parameters optimized for speed and fewer complex scenes
min_match_count = 4
ransac_reproj_threshold = 8.0
ransac_max_iters = 200
ransac_confidence = 0.90
min_inlier_ratio = 0.2
static_homography_threshold = 0.05

# Background reconstruction options
use_background_reconstruction = false
enable_panorama_cleanup = true
cleanup_black_threshold = 10
exclude_border_black_areas = true
border_exclusion_width = 10
inpaint_radius = 7

[keypoints]
# Keypoint Detection Configuration
# Confidence thresholds
human_confidence_threshold = 0.3
animal_confidence_threshold = 0.3

# Canny edge detection parameters for 'other' objects
canny_low_threshold = 50
canny_high_threshold = 150
canny_kernel_size = 3

# Corner detection parameters
corner_max_corners = 25
corner_quality_level = 0.01
corner_min_distance = 10

[semantic]
# Semantic Classification Configuration
model_name = all-MiniLM-L6-v2
human_threshold = 0.75
animal_threshold = 0.65
similarity_metric = cosine

[duplicate_filter]
# Duplicate Detection Filtering Configuration
iou_threshold = 0.7
confidence_weight = 0.6
area_weight = 0.4

[saver]
# Video encoding options: libx264, libx265, libvpx-vp9, libsvtav1
video_codec = libx264
video_quality = 23
video_preset = medium
container_format = mp4
ffmpeg_binary = ffmpeg
ffmpeg_threads = 0

# Image saving settings
image_format = png
image_quality = 95

# Output control
save_individual_objects = true
save_metadata = true
save_debug_data = true

[logging]
# Logging and progress reporting
log_level = INFO
log_to_file = true
log_filename_pattern = {input_stem}_processing.log
verbose_ffmpeg = false
collect_statistics = true
statistics_filename = processing_stats.json

[pipeline]
# PointStream Pipeline Configuration
num_workers = 1
max_parallel_scenes = 1
sequential_mode = true
enable_caching = true
cache_dir = ./cache

[muxer]
# Metadata compression settings
compression_level = 6
use_binary_format = true
remove_debug_data = true
float_precision = 6

[demuxer]
# Metadata decompression settings
restore_numpy_arrays = true
validate_homographies = true

[reconstruction]
# Client reconstruction settings
background_interpolation = linear
background_blending = gaussian
background_blur_kernel = 5
homography_smoothing = true
temporal_consistency = true
