# PointStream Client Configuration File
# This file contains all configurable parameters for the PointStream client pipeline.
# It is focused on the video reconstruction process using generative models.

[reconstruction]
# General settings for the reconstruction of video frames.

# background_blending: The method for blending reconstructed backgrounds.
# 'gaussian' provides a smoother transition.
# Affects: Quality.
background_blending = gaussian

# background_blur_kernel: The size of the kernel for Gaussian blur blending.
# Affects: Quality.
background_blur_kernel = 5

# background_interpolation: Interpolation method for transforming the background panorama.
# 'bilinear' is a good balance between speed and quality.
# Affects: Speed, Quality.
background_interpolation = bilinear

# homography_smoothing: If true, applies smoothing to homography matrices to reduce jitter in the background.
# Affects: Quality.
homography_smoothing = true

# temporal_consistency: If true, attempts to enforce temporal consistency between frames for a smoother video.
# Affects: Quality.
temporal_consistency = true

# keypoint_interpolation: The method for interpolating keypoints between frames.
# 'cubic' provides a smoother, more natural motion.
# Affects: Quality.
keypoint_interpolation = cubic

# object_smoothing: If true, applies smoothing to the motion of reconstructed objects.
# Affects: Quality.
object_smoothing = true

# motion_prediction: If true, uses motion prediction to handle occluded or missing keypoints.
# Affects: Quality.
motion_prediction = true

# occlusion_handling: If true, enables specific logic to handle cases where objects are occluded.
# Affects: Quality.
occlusion_handling = true

[models]
# Configuration for the generative models used in reconstruction.

# model_type: The type of generative model to use.
# 'cgan': Conditional Generative Adversarial Network.
# 'vae': Variational Autoencoder.
# 'diffusion': Denoising Diffusion Probabilistic Models (can be slow but high quality).
# Affects: Speed, Quality, Memory usage.
model_type = cgan

# device: The device to run the models on ('cuda' for GPU, 'cpu' for CPU).
# 'cuda' is significantly faster.
# Affects: Speed.
device = cuda

# batch_size: The number of objects to process in a single batch during generation.
# Higher values can be faster on GPU but use more memory.
# Affects: Speed, Memory usage.
batch_size = 8

# num_workers: The number of worker threads for loading data.
# Affects: Speed.
num_workers = 4

# human_model_path, animal_model_path, other_model_path:
# Paths to the pre-trained generative models for different object categories.
human_model_path = ./models/human_cgan.pth
animal_model_path = ./models/animal_cgan.pth
other_model_path = ./models/other_cgan.pth

# human_input_size, animal_input_size, other_input_size:
# The image size (in pixels) that the models expect as input.
# Must match the model's training configuration.
# Affects: Quality.
human_input_size = 256
animal_input_size = 256
other_input_size = 256

# human_keypoint_channels, animal_keypoint_channels, other_feature_channels:
# The number of input channels for the models, corresponding to keypoints or other features.
# Must match the model's architecture.
human_keypoint_channels = 17
animal_keypoint_channels = 20
other_feature_channels = 50

# human_pose_confidence_threshold, animal_pose_confidence_threshold, other_confidence_threshold:
# The minimum confidence threshold for input features (e.g., keypoints) to be used by the model.
# Affects: Quality.
human_pose_confidence_threshold = 0.3
animal_pose_confidence_threshold = 0.3
other_confidence_threshold = 0.3

[training]
# Parameters for training the generative models.

# learning_rate: The learning rate for the optimizer.
# Affects: Training speed, Stability.
learning_rate = 0.0002

# beta1, beta2: Parameters for the Adam optimizer.
# Affects: Training stability.
beta1 = 0.5
beta2 = 0.999

# num_epochs: The total number of training epochs.
# Affects: Training time, Quality.
num_epochs = 200

# save_checkpoint_every: The frequency (in epochs) for saving model checkpoints.
save_checkpoint_every = 10

# validation_split: The fraction of the training data to use for validation.
validation_split = 0.1

# adversarial_loss_weight, reconstruction_loss_weight, perceptual_loss_weight, temporal_consistency_weight:
# Weights for the different components of the loss function.
# Tuning these affects the trade-off between different aspects of reconstruction quality.
# Affects: Quality.
adversarial_loss_weight = 1.0
reconstruction_loss_weight = 100.0
perceptual_loss_weight = 10.0
temporal_consistency_weight = 5.0

# enable_augmentation: If true, applies data augmentation during training.
# Affects: Model robustness, Quality.
enable_augmentation = true

# horizontal_flip, rotation_range, scale_range, brightness_range:
# Parameters for data augmentation.
# Affects: Model robustness, Quality.
horizontal_flip = true
rotation_range = 15
scale_range = 0.1
brightness_range = 0.2

[video_reconstruction]
# Settings for assembling the final video output.

# fps: The framerate of the reconstructed video.
# This is now a fallback value if the framerate is not provided in the scene metadata.
# Affects: Smoothness of motion.
fps = 25.0

# video_codec: The video codec to use for encoding the reconstructed video.
# See the [encoding] section in the root config.ini for more details.
# Affects: Speed, Quality, File Size.
video_codec = libx264

# video_quality: The quality setting (CRF) for the video codec.
# See the [encoding] section in the root config.ini for more details.
# Affects: Quality, File Size.
video_quality = 23

# video_preset: The encoding speed preset.
# See the [encoding] section in the root config.ini for more details.
# Affects: Speed, File Size.
video_preset = medium

# container_format: The container for the final video file.
container_format = mp4

# enable_quality_metrics: If true, enables the computation of quality assessment metrics.
# Affects: Speed.
enable_quality_metrics = true

# compute_ssim, compute_psnr, compute_lpips, compute_vmaf:
# Specific quality metrics to compute. VMAF is very slow and requires an external installation.
# Affects: Speed.
compute_ssim = true
compute_psnr = true
compute_lpips = true
compute_vmaf = false

# temporal_smoothing: If true, applies a smoothing filter across frames to reduce flicker.
# Affects: Quality.
temporal_smoothing = true

# smoothing_window: The number of frames to use in the temporal smoothing window.
# Affects: Quality.
smoothing_window = 3

# motion_compensation: If true, uses motion compensation during temporal smoothing.
# Affects: Speed, Quality.
motion_compensation = true

[logging]
# Configuration for client-side logging.

# log_level: The minimum level of log messages to display (DEBUG, INFO, WARNING, ERROR).
log_level = INFO

# log_to_file: If true, logs are written to a file.
log_to_file = true

# log_filename_pattern: The naming pattern for the client log file.
log_filename_pattern = {scene_number}_client_processing.log

# enable_tensorboard: If true, enables logging to TensorBoard for visualizing training progress.
enable_tensorboard = true

# tensorboard_log_dir: The directory to store TensorBoard logs.
tensorboard_log_dir = ./logs/tensorboard

[client]
# General client-specific settings.

# max_parallel_scenes: The maximum number of scenes to reconstruct in parallel.
# Affects: Speed, Memory usage.
max_parallel_scenes = 2

# enable_caching: If true, enables caching of intermediate reconstruction data.
# Affects: Speed (on repeated runs), Disk usage.
enable_caching = true

# cache_dir: The directory to store cached client data.
cache_dir = ./cache/client

# cleanup_temp_files: If true, temporary files created during reconstruction are deleted.
cleanup_temp_files = true

# memory_optimization: If true, enables optimizations to reduce memory usage, possibly at the cost of speed.
memory_optimization = true
